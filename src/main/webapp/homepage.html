<!DOCTYPE html>
<html>

<head>
    <script>
        var currentUserObject = null;
        var homePageHtml = `
            <div class="flex-container" style="display:flex">
                <div  id="sidePane" class="flex-child magenta" style="margin-right: 80px;" >
                    <div class="green">Options Available</div>
                    <table id = "optionsAvailable">
                        <tr><td onClick="makeProfilePage()"> Profile </td></tr>
                        <tr><td onClick="contentPageRender(1)"> Add Transaction </td></tr>
                        <tr><td onClick="contentPageRender(2)"> Add Income </td></tr>
                        <tr><td onClick="contentPageRender(3)"> Add Expense </td></tr>
                        <tr><td onClick="contentPageRender(4)"> New Recurring Expense </td></tr>
                        <tr><td onClick="contentPageRender(5)"> Close Recurring Expense </td></tr>
                        <tr><td onClick="makeAllTransactionsPage()"> All Transactions </td></tr>
                        <tr><td onClick="contentPageRender(7)"> Log Out </td></tr>
                    </table>
                </div>
                <div class="flex-child green" style="flex: 1;border: 2px solid yellow;">
                    <div id="contentPart" class="blue" style="overflow-y:scroll;overflow-x:hidden;height:500px">
                        Welcome
                    </div>
                </div>
            </div>`;
		
    </script>

    <meta charset="ISO-8859-1">
    <title>HOME</title>
    <center><h1>Expense Manager</h1></head></center>
</head>

<body>
    <div id="page">
        <center><h1>Login</h1></center>
        <div class="login">
            <label><b>User Email</b></label><br><input type="text" name="userEmail" id="userEmail" placeholder="Email"><br><br>
            <label><b>Password</b></label><br><input type="password" name="password" id="password" placeholder="Password"><br><br>
            <button type="submit" onclick="loginSupport()">Login</button>
        </div>
    </div>
</body>

<script>
    function loginPageRender() {
        document.getElementById("page").innerHTML = loginHtml;
    }
    /*
async function signupSupport(){
	
}
*/

    async function loginSupport() {
        console.log("support called");
        var userEmail = document.getElementById("userEmail").value;
        var password = document.getElementById("password").value;
        let response = await fetch("http://localhost:8080/ExpenseManagement/app/loginService/login/", { // Adding method type
            method: "POST",
            // Adding body or contents to send
            body: JSON.stringify(
                { email: userEmail, password: password }
            ),
            // Adding headers to the request
            headers: {
                "Content-type": "application/json; charset=UTF-8",
                "email": userEmail,
                "password": password
            }
        });
        // Converting to JSON
        // .then(response => response.json());
        console.log(response);
        if (response.ok) {
            console.log("authed");
            homePageRender();
            let currUser = await fetch("http://localhost:8080/ExpenseManagement/app/manager/"+userEmail,{
            	method : "GET",
            	headers: {
            		"Content-type": "application/json; charset=UTF-8",
            	}
            }).then(currUser => currUser.json());
            console.log(currUser);
            currentUserObject = currUser;
        }
    }


    function homePageRender() {
        document.getElementById("page").innerHTML = homePageHtml;
    }









    function makeProfilePage(){
        document.getElementById("contentPart").innerHTML = `
            <h1>PROFILE</h1>
            <h2>Email</h2> : ${currentUserObject.email} <br>
            <h2>Mobile</h2> : ${currentUserObject.mobile}<br>
            <h2>Name</h2> : ${currentUserObject.name}<br>
            
            `;
    }


    function makeAllTransactionsPage(){
        document.getElementById("contentPart").innerHTML = `<h1>All Transactions</h1><br>`+
        	currentUserObject.transactions.map(trans => {
        	return `<div onclick=showTransaction()> Type ${trans.type} Category ${trans.category} Mode ${trans.mode}  Amount ${trans.amount}
        		Date of Transaction ${trans.dateOfTransaction}</div>
        		<br>
        	`
        }).join('');
        
    }

	function showTransaction(){
		console.log("trans");
	}























</script>

</html>